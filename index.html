<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê½ƒê¸¸ ë¦¬í¬íŠ¸ (Final Ver)</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f6f8; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 850px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .cheat-panel { background: #2c3e50; color: #fff; padding: 20px; border-radius: 12px; margin-bottom: 30px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .cheat-btn { cursor: pointer; padding: 8px 16px; font-size: 13px; background: #34495e; color: #ecf0f1; border: 1px solid #7f8c8d; border-radius: 6px; }
        .cheat-btn.accent { border-color: #e67e22; color: #e67e22; font-weight: bold; }
        .cheat-btn.green { border-color: #2ecc71; color: #2ecc71; font-weight: bold; }
        .cheat-btn.purple { background: #8e44ad; border-color: #9b59b6; font-weight: bold; }
        
        .question-block { border-bottom: 1px solid #ecf0f1; padding: 25px 0; }
        .block-divider { border-top: 3px solid #3498db; margin: 40px 0 15px; padding-top: 15px; font-weight: 800; color: #3498db; font-size: 15px; }
        .q-text { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; }
        .options { display: flex; justify-content: space-between; max-width: 550px; margin: 0 auto; background: #f9f9f9; padding: 10px 20px; border-radius: 30px; }
        .option-label { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .option-label input { margin-bottom: 8px; transform: scale(1.4); }

        .nav-buttons { display: flex; justify-content: space-between; margin-top: 50px; padding-top: 20px; border-top: 2px solid #ecf0f1; }
        .nav-btn { padding: 14px 30px; cursor: pointer; background: #3498db; color: #fff; border: none; border-radius: 8px; font-weight: bold; }
        .nav-btn:disabled { background: #bdc3c7; }

        .result-card { border: 1px solid #ecf0f1; padding: 25px; border-radius: 16px; background: #fff; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .graph-wrapper { display: flex; height: 32px; background: #ecf0f1; border-radius: 16px; margin: 15px 0; position: relative; overflow: hidden; }
        .half-zone { flex: 1; display: flex; align-items: center; height: 100%; }
        .bar-fill { height: 100%; transition: width 1s cubic-bezier(0.22, 1, 0.36, 1); }
        .blue { background: linear-gradient(90deg, #3498db, #5dade2); border-radius: 16px 0 0 16px; }
        .red { background: linear-gradient(90deg, #e74c3c, #ec7063); border-radius: 0 16px 16px 0; }
        .center-marker { position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: #2c3e50; z-index: 5; opacity: 0.3; }
        
        .ai-section { margin-top: 50px; background: #fdf2f8; padding: 25px; border-radius: 16px; border: 2px solid #f8bbd0; }
        .ai-btn { padding: 12px 25px; background: #e91e63; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #ai-result { background: #fff; padding: 20px; border-radius: 12px; margin-top: 20px; border: 1px solid #fce4ec; min-height: 100px; white-space: pre-wrap; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ¸ ê½ƒê¸¸ ë¦¬í¬íŠ¸ ë¡œì§ ê²€ì¦ê¸°</h1>

    <div class="cheat-panel">
        <button class="cheat-btn" onclick="applyCheat('TYPE_A')">Aí˜•(ì¢Œ)</button>
        <button class="cheat-btn" onclick="applyCheat('TYPE_B')">Bí˜•(ìš°)</button>
        <button class="cheat-btn" onclick="applyCheat('ALL_5')">ëª¨ë‘ 5ì </button>
        <div style="flex-basis: 100%; height: 0;"></div>
        <button class="cheat-btn accent" onclick="applyCheat('CONFLICT_AB')">âš¡ ë¶ˆì¼ì¹˜(ì¢Œ/ìš°)</button>
        <button class="cheat-btn green" onclick="applyCheat('SELF_A_PARTNER_N')">âš–ï¸ ë‚˜:ì¢Œ/ë„ˆ:ì¤‘ë¦½</button>
        <button class="cheat-btn purple" style="width:100%; font-weight:bold; margin-top:5px;" onclick="applyCheat('CUSTOM_SCENARIO')">âœ¨ ì»¤ìŠ¤í…€ ì‹œë‚˜ë¦¬ì˜¤</button>
    </div>

    <h2 id="page-title" style="color:#3498db; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 20px;">ë¡œë”© ì¤‘...</h2>
    <div id="q-container"></div>

    <div class="nav-buttons">
        <button class="nav-btn secondary" id="btn-prev" onclick="changePage(-1)">ì´ì „</button>
        <button class="nav-btn" id="btn-next" onclick="changePage(1)">ë‹¤ìŒ</button>
        <button class="nav-btn" id="btn-submit" onclick="showResult()" style="display:none; background:#2ecc71;">ê²°ê³¼ ë¶„ì„ ë³´ê¸°</button>
    </div>

    <div id="result-area" style="display:none;">
        <h2 style="margin-top:60px; text-align:center;">ğŸ“Š ìµœì¢… ë¶„ì„ ë¦¬í¬íŠ¸</h2>
        
        <div class="ai-section">
            <h3 style="color:#c2185b; text-align:center;">ğŸ¤– AI ì‹¬ì¸µ ìƒë‹´ì†Œ</h3>
            <div style="display:flex; justify-content:center; gap:10px;">
                <input type="password" id="api-key" placeholder="OpenAI API Key (sk-...)" style="padding:10px; width:300px; border-radius:8px; border:1px solid #ccc;">
                <button class="ai-btn" onclick="callAI()">ìƒë‹´ ìš”ì²­</button>
            </div>
            <div style="text-align:center; margin-top:10px;">
                <button class="cheat-btn purple" onclick="copyAiPrompt()">ğŸ“‹ í”„ë¡¬í”„íŠ¸ë§Œ ë³µì‚¬</button>
            </div>
            <div id="ai-result" style="display:none;"></div>
        </div>

        <div id="result-grid" class="result-grid"></div>
    </div>
</div>

<script src="questions.js"></script>
<script>
    let answers = {};
    let page = 0;

    window.onload = function() {
        if (typeof ALL_QS === 'undefined') {
            alert("ğŸš¨ ì˜¤ë¥˜: questions.js íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
            document.getElementById('q-container').innerHTML = "<h3 style='color:red; text-align:center;'>ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>";
            return;
        }
        // ì´ˆê¸°í™”
        for(let i=1; i<=96; i++) answers[i] = 0;
        render();
    };

    function render() {
        const container = document.getElementById('q-container');
        container.innerHTML = '';
        const isPartner = page >= 4;
        const color = isPartner ? "#E91E63" : "#3498db";
        
        document.getElementById('page-title').innerText = (isPartner ? "ğŸ’ íŒŒíŠ¸ë„ˆ ê´€ì " : "ğŸ‘¤ ë³¸ì¸ ì„±í–¥") + ` (${page+1}/8)`;
        document.getElementById('page-title').style.color = color;
        document.getElementById('page-title').style.borderColor = color;

        const start = page * 12;
        for(let i=start; i<start+12; i++) {
            if(i % 4 === 0) {
                const bIdx = Math.floor((i % 48) / 4);
                container.innerHTML += `<div class="block-divider" style="color:${color}">ğŸ“¦ ë¸”ë¡ ${bIdx+1}: ${CATS[bIdx].t}</div>`;
            }
            let qNum = i + 1;
            let html = `<div class="question-block">
                <div class="q-text">Q${qNum}. ${ALL_QS[i]}</div>
                <div class="options">`;
            for(let s=1; s<=5; s++) {
                html += `<label class="option-label"><input type="radio" name="q${qNum}" value="${s}" ${answers[qNum]==s?'checked':''} onchange="answers[${qNum}]=this.value"> <span>${s}</span></label>`;
            }
            html += `</div></div>`;
            container.innerHTML += html;
        }
        
        document.getElementById('btn-prev').disabled = (page === 0);
        document.getElementById('btn-next').style.display = (page === 7) ? 'none' : 'inline-block';
        document.getElementById('btn-submit').style.display = (page === 7) ? 'inline-block' : 'none';
        
        const btnNext = document.getElementById('btn-next');
        if(page === 3) {
            btnNext.innerText = "íŒŒíŠ¸ë„ˆ ì„¹ì…˜ìœ¼ë¡œ ì´ë™ ğŸ‘‰";
            btnNext.style.backgroundColor = "#E91E63";
        } else {
            btnNext.innerText = "ë‹¤ìŒ";
            btnNext.style.backgroundColor = "#3498db";
        }
    }

    function changePage(d) { 
        if (page+d < 0 || page+d > 7) return;
        page += d; render(); window.scrollTo(0,0); 
    }

    function applyCheat(type) {
        for(let i=1; i<=96; i++) {
            let pos = (i-1)%4; let isP = i>48;
            if(type=='TYPE_A') answers[i] = (pos < 2) ? 5 : 1;
            else if(type=='TYPE_B') answers[i] = (pos < 2) ? 1 : 5;
            else if(type=='CONFLICT_AB') answers[i] = !isP ? (pos < 2 ? 5 : 1) : (pos < 2 ? 1 : 5);
            else if(type=='CONFLICT_BA') answers[i] = !isP ? (pos < 2 ? 1 : 5) : (pos < 2 ? 5 : 1);
            else if(type=='SELF_A_PARTNER_N') answers[i] = !isP ? (pos < 2 ? 5 : 1) : 3;
            else if(type=='SELF_B_PARTNER_N') answers[i] = !isP ? (pos < 2 ? 1 : 5) : 3;
            else if(type=='RANDOM') answers[i] = Math.floor(Math.random()*5)+1;
            else if(type=='ALL_5') answers[i] = 5;
            else if(type=='CUSTOM_SCENARIO') {
                const target = [0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1];
                const bIdx = Math.floor((i-1)/4) % 12;
                const isTargetLeft = target[bIdx] === 0;
                if (!isP) answers[i] = isTargetLeft ? ((pos<2)?5:1) : ((pos<2)?1:5);
                else answers[i] = isTargetLeft ? ((pos<2)?1:5) : ((pos<2)?5:1);
            }
        }
        render();
        document.getElementById('btn-submit').style.display = 'inline-block';
        alert("ì ìš© ì™„ë£Œ");
    }

    function showResult() {
        const grid = document.getElementById('result-grid'); 
        grid.innerHTML = '';
        for(let b=0; b<12; b++) {
            let sL=0, sR=0, pL=0, pR=0;
            for(let k=0; k<2; k++) sL += parseInt(answers[b*4+k+1]||0);
            for(let k=2; k<4; k++) sR += parseInt(answers[b*4+k+1]||0);
            const off = 48;
            for(let k=0; k<2; k++) pL += parseInt(answers[b*4+k+1+off]||0);
            for(let k=2; k<4; k++) pR += parseInt(answers[b*4+k+1+off]||0);
            
            let sPol = (sR/2) - (sL/2);
            let pPol = (pR/2) - (pL/2);
            let total = (sPol * 0.8) + (pPol * 0.2);
            
            const getTxt = (v, l, r) => {
                let av = Math.abs(v); let t = v < 0 ? l : r;
                if(av < 0.5) return `<strong>${l}/${r}</strong> ê· í˜•`;
                if(av < 1.5) return `ì•½ê°„ <strong>${t}</strong>ì¸ í¸`;
                if(av < 2.5) return `ëŒ€ì²´ë¡œ <strong>${t}</strong>ì¸ í¸`;
                if(av < 3.5) return `í™•ê³ í•œ <strong>${t}</strong> ì„±í–¥`;
                return `ë§¤ìš° ê°•í•œ <strong>${t}</strong> ì„±í–¥`;
            };

            let wLeft = total < 0 ? (Math.abs(total)/4)*100 : 0;
            let wRight = total > 0 ? (Math.abs(total)/4)*100 : 0;

            grid.innerHTML += `<div class="result-card">
                <div class="card-header">${CATS[b].t}</div>
                <div class="label-row"><span>${CATS[b].l}</span><span>${CATS[b].r}</span></div>
                <div class="graph-wrapper">
                    <div class="center-marker"></div>
                    <div class="half-zone left-zone"><div class="bar-fill blue" style="width: ${wLeft}%"></div></div>
                    <div class="half-zone right-zone"><div class="bar-fill red" style="width: ${wRight}%"></div></div>
                </div>
                <div class="total-score">ì¢…í•©: ${total.toFixed(2)}</div>
                <div class="desc-box">
                    <div class="desc-line">ğŸ‘¤ <strong>ë³¸ì¸:</strong> ë‚˜ëŠ” ${getTxt(sPol, CATS[b].l, CATS[b].r)} (${sPol.toFixed(1)})</div>
                    <div class="desc-line">ğŸ’ <strong>íŒŒíŠ¸ë„ˆ:</strong> ë‚˜ë¥¼ ${getTxt(pPol, CATS[b].l, CATS[b].r)} (${pPol.toFixed(1)})</div>
                </div>
            </div>`;
        }
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('result-area').scrollIntoView({behavior:'smooth'});
    }

    async function callAI() {
        const apiKey = document.getElementById('api-key').value.trim();
        if(!apiKey) return alert("API Key í•„ìš”");
        const resultDiv = document.getElementById('ai-result');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<div class="loading">ğŸ§  AIê°€ 12ê°œ í•­ëª© ì „ì²´ë¥¼ ì •ë°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';

        let dataStr = "";
        for(let b=0; b<12; b++) {
            let sL=0, sR=0, pL=0, pR=0;
            for(let k=0; k<2; k++) sL += parseInt(answers[b*4+k+1]||0);
            for(let k=2; k<4; k++) sR += parseInt(answers[b*4+k+1]||0);
            const off = 48;
            for(let k=0; k<2; k++) pL += parseInt(answers[b*4+k+1+off]||0);
            for(let k=2; k<4; k++) pR += parseInt(answers[b*4+k+1+off]||0);
            let sPol = (sR/2) - (sL/2);
            let pPol = (pR/2) - (pL/2);
            dataStr += `[í•­ëª© ${b+1}: ${CATS[b].t}]
- ë³¸ì¸ì˜ ì‹¤ì œ ì„±í–¥: ${sPol.toFixed(1)}ì 
- íŒŒíŠ¸ë„ˆê°€ ë³´ëŠ” ë‚˜ì˜ ëª¨ìŠµ: ${pPol.toFixed(1)}ì 

`;
        }

        const sysMsg = `ë‹¹ì‹ ì€ ì»¤í”Œ ì„±í–¥ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ ê°€ì´ë“œë¼ì¸ì„ 'ì—„ê²©íˆ' ì¤€ìˆ˜í•˜ì„¸ìš”.
1. **ì ˆëŒ€ ê·œì¹™**: 'íŒŒíŠ¸ë„ˆ ì ìˆ˜'ëŠ” íŒŒíŠ¸ë„ˆ ë³¸ì¸ì˜ ì„±í–¥ì´ ì•„ë‹ˆë¼, 'íŒŒíŠ¸ë„ˆê°€ ê´€ì°°í•œ ì‚¬ìš©ìì˜ ëª¨ìŠµ'ì…ë‹ˆë‹¤. "ë‹¹ì‹ ì€ ~í•œë° íŒŒíŠ¸ë„ˆëŠ” ~í•˜êµ°ìš”"ë¼ê³  í•´ì„í•˜ì„¸ìš”.
2. **ì–´ì¡°**: ì •ì¤‘í•œ ìƒë‹´ì²´ (~í•˜ì‹­ë‹ˆë‹¤, ~í•˜ëŠ” í¸ì…ë‹ˆë‹¤).
3. **í•­ëª©ë³„ êµ¬ì¡°**: 
   - ë¬¸ë‹¨1: ì‚¬ìš©ìì˜ ì„±í–¥ ë¬˜ì‚¬ (0ì ëŒ€: ìœ ì—°/ê· í˜•, 2ì +: í™•ê³ ).
   - ë¬¸ë‹¨2: ê´€ê³„ ì—­í•™. ì ìˆ˜ ì°¨ì´ê°€ 2.0 ì´ìƒì´ë©´ "ì˜¤í•´í•  ê°€ëŠ¥ì„±", "ì¡°ìœ¨ì´ í•„ìš”í•œ ì§€ì " í‚¤ì›Œë“œ í•„ìˆ˜ ì‚¬ìš©.
4. **ì¶œë ¥**: 12ê°œ ëª¨ë“  í•­ëª©ì„ í•˜ë‚˜ì”© ìˆœì„œëŒ€ë¡œ ë¹ ì§ì—†ì´ ë¶„ì„í•˜ì„¸ìš”.`;

        try {
            const resp = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: [{ role: "system", content: sysMsg }, { role: "user", content: `ë°ì´í„°:
${dataStr}` }],
                    temperature: 0.7
                })
            });
            const res = await resp.json();
            if(res.error) throw new Error(res.error.message);
            resultDiv.innerHTML = res.choices[0].message.content.replace(/\n/g, "<br>");
        } catch (e) { resultDiv.innerHTML = `<div style="color:red">ğŸš¨ ì˜¤ë¥˜: ${e.message}</div>`; }
    }

    function copyAiPrompt() {
        // ë³µì‚¬ ë¡œì§ (ê°„ì†Œí™”)
        alert("API ì—°ë™ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë³´ì„¸ìš”!");
    }
</script>
</body>
</html>